@page "/ajouter-utilisateur"
@using BlazorApp1.Components.Data
@using UserModel = BlazorApp1.Components.Data.User
@using Microsoft.EntityFrameworkCore
@inject ApplicationDbContext DbContext
@inject NavigationManager Navigation

<h3>Créer un utilisateur</h3>

<EditForm Model="@newUser" OnValidSubmit="HandleValidSubmit" FormName="ajout-utilisateur">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-2">
        <label>Nom :</label>
        <InputText @bind-Value="newUser.Nom" placeholder="Nom" class="form-control" />
    </div>

    <div class="mb-2">
        <label>Email :</label>
        <InputText @bind-Value="newUser.Email" placeholder="Email" class="form-control" />
    </div>

    <div class="mb-2">
        <label>Téléphone :</label>
        <InputText @bind-Value="newUser.Telephone" placeholder="Téléphone" class="form-control" />
    </div>

    <div class="mb-2">
        <label>Mot de passe :</label>
        <InputText @bind-Value="newUser.MotDePasse" placeholder="Mot de passe" type="password" class="form-control" />
    </div>

    <div class="form-check mb-3">
        <InputCheckbox @bind-Value="newUser.EstAdmin" class="form-check-input" />
        <label class="form-check-label">Administrateur</label>
    </div>

    <button type="submit" class="btn btn-primary">Ajouter</button>
</EditForm>

@if (!string.IsNullOrWhiteSpace(message))
{
    <div class="alert @alertClass mt-3">@message</div>
}

@code {
    private UserModel newUser = new();
    private string? message;
    private string alertClass = "alert-success";

    private async Task HandleValidSubmit()
    {
        try
        {
            DbContext.Users.Add(newUser);
            await DbContext.SaveChangesAsync();

            message = "Utilisateur ajouté avec succès !";
            alertClass = "alert-success";
            newUser = new();

            // ➕ Optionnel : redirection après ajout
            // Navigation.NavigateTo("/utilisateurs");
        }
        catch (Exception ex)
        {
            message = $"Erreur : {ex.Message}";
            alertClass = "alert-danger";
        }
    }
}
