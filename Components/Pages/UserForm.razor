@page "/ajouter-utilisateur"
@using BlazorApp1.Components.Data
@using UserModel = BlazorApp1.Components.Data.User
@using Microsoft.EntityFrameworkCore
@rendermode InteractiveServer
@inject ApplicationDbContext DbContext

<h3>Créer un utilisateur</h3>

<EditForm Model="@newUser" OnValidSubmit="HandleValidSubmit" FormName="ajout-utilisateur">


    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-2">
        <label>Nom :</label>
        <InputText @bind-Value="newUser.Nom" placeholder="Nom" class="form-control" />
    </div>

    <div class="mb-2">
        <label>Email :</label>
        <InputText @bind-Value="newUser.Email" placeholder="Email" class="form-control" />
    </div>

    <button type="submit" class="btn btn-primary">Ajouter</button>

</EditForm>

@if (!string.IsNullOrWhiteSpace(message))
{
    <div class="alert alert-success mt-2">@message</div>
}

@code {
    private BlazorApp1.Components.Data.User newUser = new(); // Le modèle lié au formulaire
    private string? message; // Message de confirmation
 
    private async Task HandleValidSubmit()
    {
        message = "HandleValidSubmit déclenché !";
        try
        {
            // Ajout du nouvel utilisateur à la base
            DbContext.Users.Add(newUser);
            await DbContext.SaveChangesAsync();

            // Message de succès
            message = "Utilisateur ajouté avec succès !";

            // Réinitialisation du formulaire
            newUser = new();
        }
        catch (Exception ex)
        {
            // Gestion d’erreur en cas d’échec
            message = $"Erreur lors de l’ajout de l’utilisateur : {ex.Message}";
        }
    }
}