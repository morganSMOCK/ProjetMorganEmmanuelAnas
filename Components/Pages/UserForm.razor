@page "/ajouter-utilisateur"
@using BlazorApp1.Components.Data
@using BlazorApp1.Services
@using MongoDB.Driver
@rendermode InteractiveServer
@inject MongoDBService MongoDBService

<h3>Créer un utilisateur</h3>

<EditForm Model="@newUtilisateur" OnValidSubmit="HandleValidSubmit" FormName="ajout-utilisateur">

    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-2">
        <label>Nom :</label>
        <InputText @bind-Value="newUtilisateur.Nom" placeholder="Nom" class="form-control" />
    </div>

    <div class="mb-2">
        <label>Email :</label>
        <InputText @bind-Value="newUtilisateur.Email" placeholder="Email" class="form-control" />
    </div>

    <button type="submit" class="btn btn-primary">Ajouter</button>

</EditForm>

@if (!string.IsNullOrWhiteSpace(message))
{
    <div class="alert alert-success mt-2">@message</div>
}

@code {
    private Utilisateur newUtilisateur = new(); // Le modèle lié au formulaire
    private string? message; // Message de confirmation

    private async Task HandleValidSubmit()
    {
        message = "HandleValidSubmit déclenché !";
        try
        {
            // Ajout du nouvel utilisateur à la base MongoDB
            await MongoDBService.AddUtilisateurAsync(newUtilisateur);

            // Message de succès
            message = "Utilisateur ajouté avec succès !";

            // Réinitialisation du formulaire
            newUtilisateur = new();
        }
        catch (Exception ex)
        {
            // Gestion d’erreur en cas d’échec
            message = $"Erreur lors de l’ajout de l’utilisateur : {ex.Message}";
        }
    }
}
